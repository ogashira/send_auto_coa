# GEMINI.md: プロジェクト `send_auto_coa`

## プロジェクト概要

このプロジェクトは、検査成績書（COA）を顧客にメールで自動送信するために設計された、Pythonベースのコマンドラインアプリケーションです。ユーザーが指定した納入日に基づいて送信が必要なCOAを特定し、注文番号ごとにzipアーカイブにまとめ、適切な宛先にメールで送信します。また、二重送信を防ぐために送信済みファイルのログを記録します。

アプリケーションは、モジュール化されたオブジェクト指向の構造で設計されており、ユーザーとの対話、ファイル管理、ビジネスロジック（送信すべきCOAの決定）、メール送信などを処理するための個別のクラスで構成されています。

**主要技術:**
*   **言語:** Python 3.10
*   **依存関係:** PyYAML（設定ファイル用）

## ビルドと実行

### 前提条件

1.  **Python 3.10:** Python 3.10または互換性のあるバージョンがインストールされていることを確認してください。
2.  **依存関係:** 必要なPyYAMLライブラリをインストールします。`requirements.txt`が存在しないため、pipでインストールできます。
    ```bash
    pip install PyYAML
    ```
3.  **設定ファイル:** アプリケーションの実行には、`mail_info.yaml`という名前の設定ファイルへのアクセスが必要です。このファイルには、SMTPサーバーの詳細と受信者のメール情報が含まれています。期待されるパスはハードコーディングされており、プラットフォームに依存してネットワーク共有を指しています（例: `//192.168.1.247/共有/技術課ﾌｫﾙﾀﾞ/200. effit_data/ﾏｽﾀ/coaﾒｰﾙ送信関連/mail_info.yaml`）。このファイルにアクセスできない場合、アプリケーションは失敗します。
4.  **ファイルシステム構造:** アプリケーションは、COAのPDFファイルを読み込むために特定のディレクトリ構造を期待しています。通常、`testreport/輸出/`のようなパスに配置されます。

### アプリケーションの実行

1.  **標準モード:** アプリケーションを実行するには、`main.py`スクリプトを実行します。送信したいCOAの納入日を入力するよう求められます。

    ```bash
    python main.py
    ```
    次のようなプロンプトが表示されます:
    ```
    納入日を入力してください(例 : 20220930) / Returnで中止
    納入日 :
    ```
    日付を`YYYYMMDD`形式で入力し、Enterキーを押します。

2.  **テストモード:** 実際のメール送信を防ぎ、異なるファイルパスを使用する可能性があるテストモードが利用可能です。使用するには、コマンドライン引数として`test`を指定します。

    ```bash
    python main.py test
    ```

## 開発規約

*   **構造:** コードはクラスに整理されており、それぞれが特定の責任を持つオブジェクト指向のアプローチに従っています。
    *   `main.py`: アプリケーションのエントリーポイント。
    *   `control.py`: 全体的なワークフローを調整するメインコントローラー。
    *   `user_interface.py`: ユーザーからのすべてのコマンドライン入力を処理します。
    *   `mail_manage.py`: SMTPを使用したメールの作成と送信を管理します。
    *   `folder_manage.py`: ディレクトリ（zipファイルやログ用など）の作成と管理を処理します。
    *   `order_no_should_send.py`: 保留中でCOAの送信が必要な注文を決定するロジックを含みます。
    *   `coas_should_zip.py`: 特定の注文のCOAのzipアーカイブを作成するプロセスを管理します。
*   **ロギング:** アプリケーションは実行ごとに`log`ディレクトリ内にログファイルを生成し、実行された操作、成功、失敗を詳述します。
*   **状態管理:** アプリケーションは、対応するzipファイルを`送信済`（"Sent"）サブディレクトリに移動することで、正常に送信されたCOAを追跡します。これにより、同じ証明書が複数回送信されるのを防ぎます。
*   **設定:** 外部設定はYAMLファイルから読み込まれ、機密データ（認証情報など）と受信者情報をソースコードから分離しています。